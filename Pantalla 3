import streamlit as st
from utils.afinidad import calcular_afinidad
from datos.herramientas import df_herramientas

def mostrar_pantalla_3(cambiar_pantalla):
    st.title("ğŸ”§ Recomendaciones de Herramientas")
    st.write("BasÃ¡ndonos en los parÃ¡metros seleccionados, aquÃ­ tienes las herramientas ideales para tus proyectos.")

    # Recuperar los parÃ¡metros seleccionados
    parametros = st.session_state.get("parametros", {})
    if not parametros:
        st.warning("âš  No se encontraron parÃ¡metros guardados. Por favor, regresa a la Pantalla 1.")
        if st.button("Regresar a Pantalla 1"):
            cambiar_pantalla("pantalla_1")
        return

    # Calcular afinidad de herramientas
    recomendaciones = calcular_afinidad(parametros, df_herramientas)

    if not recomendaciones:
        st.warning("No se encontraron herramientas relevantes para los parÃ¡metros seleccionados.")
        if st.button("Regresar a Pantalla 2"):
            cambiar_pantalla("pantalla_2")
        return

    # Mostrar la herramienta principal
    herramienta_principal = recomendaciones[0]
    st.header("ğŸŒŸ RecomendaciÃ³n Principal")
    st.subheader(herramienta_principal["nombre"])
    st.write(herramienta_principal["descripcion"])
    st.markdown(f"[Visitar herramienta]({herramienta_principal['url']})")

    # Mostrar herramientas adicionales
    if len(recomendaciones) > 1:
        st.header("ğŸ”§ Otras Herramientas Recomendadas")
        for herramienta in recomendaciones[1:4]:  # MÃ¡ximo 3 alternativas
            st.subheader(herramienta["nombre"])
            st.write(herramienta["descripcion"])
            st.markdown(f"[Visitar herramienta]({herramienta['url']})")

    # BotÃ³n para regresar a Pantalla 2
    if st.button("Regresar a Editar Prompt"):
        cambiar_pantalla("pantalla_2")

    # BotÃ³n para finalizar
    if st.button("Finalizar"):
        st.success("ğŸ‰ Gracias por usar el asistente. Â¡Esperamos que disfrutes de las recomendaciones!")
